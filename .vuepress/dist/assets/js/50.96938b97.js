(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{465:function(e,t,r){"use strict";r.r(t);var a=r(62),l=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{align:"center"}},[e._v("Raft")]),e._v(" "),r("div",{staticStyle:{"border-color":"#24C6DC","background-color":"#e9f9f3",margin:"1rem 0",padding:".25rem 1rem","border-left-width":".3rem","border-left-style":"solid","border-radius":".5rem",color:"inherit"}},[r("p",[e._v("è¿™æ˜¯å…­åˆ™æˆ–è®¸å¯¹ä½ æœ‰äº›è®¸å¸®åŠ©çš„ä¿¡æ¯:")]),e._v(" "),r("p",[e._v("â­ï¸1ã€é˜¿ç§€ä¸æœ‹å‹åˆä½œå¼€å‘äº†ä¸€ä¸ª"),r("span",{staticStyle:{"font-weight":"bold",color:"red"}},[e._v("ç¼–ç¨‹èµ„æºç½‘ç«™")]),e._v("ï¼Œç›®å‰å·²ç»æ”¶å½•äº†å¾ˆå¤šä¸é”™çš„å­¦ä¹ èµ„æºå’Œé»‘ç§‘æŠ€ï¼ˆé™„å¸¦ä¸‹è½½åœ°å€ï¼‰ï¼Œå¦‚è¿‡ä½ æƒ³è¦å¯»æ±‚åˆé€‚çš„ç¼–ç¨‹èµ„æºï¼Œ"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://tools.interviewguide.cn/home",target:"_blank"}},[e._v("æ¬¢è¿ä½“éªŒ")]),e._v("ä»¥åŠæ¨èè‡ªå·±è®¤ä¸ºä¸é”™çš„èµ„æºï¼Œä¼—äººæ‹¾æŸ´ç«ç„°é«˜ï¼Œæˆ‘ä¸ºäººäººï¼Œäººäººä¸ºæˆ‘ğŸ”¥ï¼")]),e._v(" "),r("p",[e._v("2ã€ğŸ‘‰23å¹´5æœˆä»½é˜¿ç§€ä»"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://mp.weixin.qq.com/s?__biz=Mzk0ODU4MzEzMw==&mid=2247512170&idx=1&sn=c4a04a383d2dfdece676b75f17224e78",target:"_blank"}},[e._v("å­—èŠ‚è·³åŠ¨ç¦»èŒè·³æ§½åˆ°æŸå¤–ä¼")]),e._v("æœŸé—´ï¼Œä¸º"),r("span",{staticStyle:{"font-weight":"bold"}},[e._v("æ–¹ä¾¿è‡ªå·±æ‰¾å·¥ä½œï¼Œå¢åŠ ä¸Šå²¸å‡ ç‡")]),e._v("ï¼Œæˆ‘è‡ªå·±ä»0å¼€å‘äº†ä¸€ä¸ª"),r("span",{staticStyle:{"font-weight":"bold",color:"red"}},[e._v("äº’è”ç½‘ä¸­å¤§å‚é¢è¯•çœŸé¢˜è§£æç½‘ç«™")]),e._v("ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªå‰ç«¯å’Œä¸€ä¸ªåç«¯ã€‚èƒ½å¤Ÿå®šå‘æŸ¥çœ‹æŸäº›å…¬å¸çš„æŸäº›å²—ä½é¢è¯•çœŸé¢˜ï¼Œæ¯”å¦‚æˆ‘æƒ³æŸ¥ä¸€ä¸‹è¡Œä¸šä¸ºäº’è”ç½‘ï¼Œå…¬å¸ä¸ºå­—èŠ‚è·³åŠ¨ï¼Œè€ƒå¯Ÿå²—ä½ä¸ºåç«¯ï¼Œè€ƒå¯Ÿæ—¶é—´ä¸ºæœ€è¿‘ä¸€å¹´ä¹‹ç±»çš„é¢è¯•é¢˜æœ‰å“ªäº›ï¼Ÿ\n")]),r("div",{attrs:{align:"center"}}),e._v("ç½‘ç«™åœ°å€ï¼š"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://top.interviewguide.cn/",target:"_blank"}},[e._v("InterviewGuideå¤§å‚é¢è¯•çœŸé¢˜è§£æç½‘ç«™")]),e._v("ã€‚ç‚¹æ­¤å¯ä»¥æŸ¥çœ‹è¯¥ç½‘ç«™çš„è§†é¢‘ä»‹ç»ï¼š"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://www.bilibili.com/video/BV1f94y1C7BL",target:"_blank"}},[e._v("Bç«™è§†é¢‘è®²è§£")]),e._v("   å¦‚æœå¯ä»¥çš„è¯æ±‚ä¸ªBç«™ä¸‰è¿ï¼Œæ„Ÿè°¢ï¼\n  "),r("p"),e._v("3ã€ğŸ˜Š\n    åˆ†äº«ä¸€ä¸ªå­¦å¼Ÿå‘ç»™æˆ‘çš„"),r("span",{staticStyle:{"font-weight":"bold",color:"red"}},[e._v("20Tç½‘ç›˜èµ„æºåˆé›†")]),e._v("ï¼Œ"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://docs.qq.com/sheet/DY3VPVklVaFFMcUZ4?tab=9h5afr",target:"_blank"}},[e._v("ç‚¹æ­¤ç™½å«–")]),e._v("ï¼Œä¸»è¦æ˜¯å„ç±»é«˜æ¸…å½±è§†ã€ç”µè§†å‰§ã€éŸ³ä¹ã€å‰¯ä¸šã€çºªå½•ç‰‡ã€è‹±è¯­å››å…­çº§è€ƒè¯•ã€è€ƒç ”è€ƒå…¬ç­‰èµ„æºã€‚\n  "),r("p"),e._v(" "),r("p",[e._v("4ã€ğŸ˜å…è´¹åˆ†äº«é˜¿ç§€ä¸ªäººå­¦ä¹ è®¡ç®—æœºä»¥æ¥æ”¶é›†åˆ°çš„å…è´¹å­¦ä¹ èµ„æºï¼Œ"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"/notes/07-resources/01-free/01-introduce.html",target:"_blank"}},[e._v("ç‚¹æ­¤ç™½å«–")]),e._v("ï¼›ä¹Ÿè®°å½•ä¸€ä¸‹è‡ªå·±ä»¥å‰ä¹°è¿‡çš„"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"/notes/07-resources/02-precious.html",target:"_blank"}},[e._v("ä¸é”™çš„è®¡ç®—æœºä¹¦ç±ã€ç½‘ç»œä¸“æ å’Œåƒåœ¾ä»˜è´¹ä¸“æ ")]),e._v("ï¼›ä¹Ÿè®°å½•ä¸€ä¸‹è‡ªå·±ä»¥å‰ä¹°è¿‡çš„"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"/notes/07-resources/02-precious.html",target:"_blank"}},[e._v("ä¸é”™çš„è®¡ç®—æœºä¹¦ç±ã€ç½‘ç»œä¸“æ å’Œåƒåœ¾ä»˜è´¹ä¸“æ ")])]),e._v(" "),r("p",[e._v("5ã€ğŸš€å¦‚æœä½ æƒ³åœ¨æ ¡æ‹›ä¸­é¡ºåˆ©æ‹¿åˆ°æ›´å¥½çš„offerï¼Œé˜¿ç§€å»ºè®®ä½ å¤šçœ‹çœ‹å‰äºº"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://www.yuque.com/tuobaaxiu/httmmc/npg1k81zeq4wfpyz",target:"_blank"}},[e._v("è¸©è¿‡çš„å‘")]),e._v("å’Œ"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{target:"_blank",href:"https://www.yuque.com/tuobaaxiu/httmmc/gge9ppd0mbu2d3dp"}},[e._v("ç•™ä¸‹çš„ç»éªŒ")]),e._v("ï¼Œäº‹å®ä¸Šä½ ç°åœ¨é‡åˆ°çš„å¤§å¤šæ•°é—®é¢˜ä½ çš„å­¦é•¿å­¦å§å¸ˆå…„å¸ˆå§åŸºæœ¬éƒ½å·²ç»é‡åˆ°è¿‡äº†ã€‚\n  ")]),e._v(" "),r("p",[e._v("6ã€ğŸ”¥ æ¬¢è¿å‡†å¤‡è®¡ç®—æœºæ ¡æ‹›çš„å°ä¼™ä¼´åŠ å…¥æˆ‘çš„"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://www.yuque.com/tuobaaxiu/httmmc/xg0otqvc17wfx4u9",target:"_blank"}},[e._v("å­¦ä¹ åœˆå­")]),e._v("ï¼Œä¸€ä¸ªäººè¸½è¸½ç‹¬è¡Œä¸å¦‚ä¸€ç¾¤äººæŠ¥å›¢å–æš–ï¼Œåœˆå­é‡Œæ²‰æ·€äº†å¾ˆå¤šè¿‡å»21/22/23å±Šå­¦é•¿å­¦å§çš„"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://www.yuque.com/tuobaaxiu/httmmc/gge9ppd0mbu2d3dp",target:"_blank"}},[e._v("ç»éªŒå’Œæ€»ç»“")]),e._v("ï¼Œå¥½å¥½è·Ÿç€èµ°ä¸‹å»çš„ï¼Œæœ€ååŸºæœ¬éƒ½å¯ä»¥æ‹¿åˆ°ä¸é”™çš„offerï¼æ­¤å¤–ï¼Œæ¯å‘¨éƒ½ä¼šè¿›è¡Œ"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://www.yuque.com/tuobaaxiu/httmmc/npg1k81zeq4wfpyz",target:"_blank"}},[e._v("ç²¾åæ€»ç»“å’Œåˆ†äº«ï¼")]),e._v("å¦‚æœä½ éœ€è¦ã€Šé˜¿ç§€çš„å­¦ä¹ ç¬”è®°ã€‹ç½‘ç«™ä¸­ğŸ“šï¸æ ¡æ‹›å…«è‚¡æ–‡ç›¸å…³çŸ¥è¯†ç‚¹çš„PDFç‰ˆæœ¬çš„è¯ï¼Œå¯ä»¥"),r("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"https://www.yuque.com/tuobaaxiu/httmmc/qs0yn66apvkzw0ps",target:"_blank"}},[e._v("ç‚¹æ­¤ä¸‹è½½")]),e._v(" ã€‚")])]),e._v(" "),r("h2",{attrs:{id:"_1ã€raft-overview"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1ã€raft-overview"}},[e._v("#")]),e._v(" 1ã€Raft Overview")]),e._v(" "),r("blockquote",[r("p",[e._v("Raft ç®—æ³•è®²è§£")])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",[r("code",[e._v("\traft æ˜¯å·¥ç¨‹ä¸Šä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„å¼ºä¸€è‡´æ€§ã€å»ä¸­å¿ƒåŒ–ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼åè®®ã€‚åœ¨è¿™é‡Œå¼ºè°ƒäº†æ˜¯åœ¨å·¥ç¨‹ä¸Šï¼Œå› ä¸ºåœ¨å­¦æœ¯ç†è®ºç•Œï¼Œæœ€è€€çœ¼çš„è¿˜æ˜¯å¤§åé¼é¼çš„ Paxosã€‚ä½† Paxos æ˜¯ï¼šå°‘æ•°çœŸæ­£ç†è§£çš„äººè§‰å¾—ç®€å•ï¼Œå°šæœªç†è§£çš„äººè§‰å¾—å¾ˆéš¾ï¼Œå¤§å¤šæ•°äººéƒ½æ˜¯ä¸€çŸ¥åŠè§£ã€‚æœ¬äººä¹ŸèŠ±äº†å¾ˆå¤šæ—¶é—´ã€çœ‹äº†å¾ˆå¤šææ–™ä¹Ÿæ²¡æœ‰çœŸæ­£ç†è§£ã€‚ç›´åˆ°çœ‹åˆ° raft çš„è®ºæ–‡ï¼Œä¸¤ä½ç ”ç©¶è€…ä¹Ÿæåˆ°ï¼Œä»–ä»¬ä¹ŸèŠ±äº†å¾ˆé•¿çš„æ—¶é—´æ¥ç†è§£ Paxosï¼Œä»–ä»¬ä¹Ÿè§‰å¾—å¾ˆéš¾ç†è§£ï¼Œäºæ˜¯ç ”ç©¶å‡ºäº† raft ç®—æ³•ã€‚\n")])])]),r("p",[e._v("â€‹\t\t raft æ˜¯ä¸€ä¸ªå…±è¯†ç®—æ³•ï¼ˆconsensus algorithmï¼‰ï¼Œæ‰€è°“å…±è¯†ï¼Œå°±æ˜¯å¤šä¸ªèŠ‚ç‚¹å¯¹æŸä¸ªäº‹æƒ…è¾¾æˆä¸€è‡´çš„çœ‹æ³•ï¼Œå³ä½¿æ˜¯åœ¨éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œå»¶æ—¶ã€ç½‘ç»œåˆ†å‰²çš„æƒ…å†µä¸‹ã€‚è¿™äº›å¹´æœ€ä¸ºç«çƒ­çš„åŠ å¯†è´§å¸ï¼ˆæ¯”ç‰¹å¸ã€åŒºå—é“¾ï¼‰å°±éœ€è¦å…±è¯†ç®—æ³•ï¼Œè€Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå…±è¯†ç®—æ³•æ›´å¤šç”¨äºæé«˜ç³»ç»Ÿçš„å®¹é”™æ€§ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼å­˜å‚¨ä¸­çš„å¤åˆ¶é›†ï¼ˆreplicationï¼‰ï¼Œåœ¨"),r("a",{attrs:{href:"https://www.cnblogs.com/xybaby/p/7153755.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("å¸¦ç€é—®é¢˜å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹ä¸­å¿ƒåŒ–å¤åˆ¶é›†"),r("OutboundLink")],1),e._v("ä¸€æ–‡ä¸­ä»‹ç»äº†ä¸­å¿ƒåŒ–å¤åˆ¶é›†çš„ç›¸å…³çŸ¥è¯†ã€‚raft åè®®å°±æ˜¯ä¸€ç§ leader-based çš„å…±è¯†ç®—æ³•ï¼Œä¸ä¹‹ç›¸åº”çš„æ˜¯ leaderless çš„å…±è¯†ç®—æ³•ã€‚")]),e._v(" "),r("p",[e._v("Raft ç®—æ³•çš„å¤´å·ç›®æ ‡å°±æ˜¯å®¹æ˜“ç†è§£ï¼ˆUnderStandableï¼‰ï¼Œè¿™ä»è®ºæ–‡çš„æ ‡é¢˜å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚å½“ç„¶ï¼ŒRaft å¢å¼ºäº†å¯ç†è§£æ€§ï¼Œåœ¨æ€§èƒ½ã€å¯é æ€§ã€å¯ç”¨æ€§æ–¹é¢æ˜¯ä¸è¾“äº Paxos çš„ã€‚")]),e._v(" "),r("blockquote",[r("p",[e._v("Raft more understandable than Paxos and also provides a better foundation for building practical systems")])]),e._v(" "),r("p",[e._v("ä¸ºäº†è¾¾åˆ°æ˜“äºç†è§£çš„ç›®æ ‡ï¼Œraft åšäº†å¾ˆå¤šåŠªåŠ›ï¼Œå…¶ä¸­æœ€ä¸»è¦æ˜¯ä¸¤ä»¶äº‹æƒ…ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("é—®é¢˜åˆ†è§£")]),e._v(" "),r("li",[e._v("çŠ¶æ€ç®€åŒ–")])]),e._v(" "),r("p",[e._v('é—®é¢˜åˆ†è§£æ˜¯å°† "å¤åˆ¶é›†ä¸­èŠ‚ç‚¹ä¸€è‡´æ€§" è¿™ä¸ªå¤æ‚çš„é—®é¢˜åˆ’åˆ†ä¸ºæ•°ä¸ªå¯ä»¥è¢«ç‹¬ç«‹è§£é‡Šã€ç†è§£ã€è§£å†³çš„å­é—®é¢˜ã€‚åœ¨ raftï¼Œå­é—®é¢˜åŒ…æ‹¬ï¼Œ'),r("em",[e._v("leader election")]),e._v("ï¼Œ "),r("em",[e._v("log replication")]),e._v("ï¼Œ"),r("em",[e._v("safety")]),e._v("ï¼Œ"),r("em",[e._v("membership changes")]),e._v("ã€‚è€ŒçŠ¶æ€ç®€åŒ–æ›´å¥½ç†è§£ï¼Œå°±æ˜¯å¯¹ç®—æ³•åšå‡ºä¸€äº›é™åˆ¶ï¼Œå‡å°‘éœ€è¦è€ƒè™‘çš„çŠ¶æ€æ•°ï¼Œä½¿å¾—ç®—æ³•æ›´åŠ æ¸…æ™°ï¼Œæ›´å°‘çš„ä¸ç¡®å®šæ€§ï¼ˆæ¯”å¦‚ï¼Œä¿è¯æ–°é€‰ä¸¾å‡ºæ¥çš„ leader ä¼šåŒ…å«æ‰€æœ‰ commited log entryï¼‰")]),e._v(" "),r("blockquote",[r("p",[e._v("Raft implements consensus by first electing a distinguished leader, then giving the leader complete responsibility for managing the replicated log. The leader accepts log entries from clients, replicates them on other servers, and tells servers when it is safe to apply log entries to their state machines. A leader can fail or become disconnected from the other servers, in which case a new leader is elected.")])]),e._v(" "),r("p",[e._v("ä¸Šé¢çš„å¼•æ–‡å¯¹ raft åè®®çš„å·¥ä½œåŸç†è¿›è¡Œäº†é«˜åº¦çš„æ¦‚æ‹¬ï¼šraft ä¼šå…ˆé€‰ä¸¾å‡º leaderï¼Œleader å®Œå…¨è´Ÿè´£ replicated log çš„ç®¡ç†ã€‚leader è´Ÿè´£æ¥å—æ‰€æœ‰å®¢æˆ·ç«¯æ›´æ–°è¯·æ±‚ï¼Œç„¶åå¤åˆ¶åˆ° follower èŠ‚ç‚¹ï¼Œå¹¶åœ¨ â€œå®‰å…¨â€ çš„æ—¶å€™æ‰§è¡Œè¿™äº›è¯·æ±‚ã€‚å¦‚æœ leader æ•…éšœï¼Œfollowes ä¼šé‡æ–°é€‰ä¸¾å‡ºæ–°çš„ leaderã€‚")]),e._v(" "),r("p",[e._v("è¿™å°±æ¶‰åŠåˆ° raft æœ€æ–°çš„ä¸¤ä¸ªå­é—®é¢˜ï¼š leader election å’Œ log replication")]),e._v(" "),r("h2",{attrs:{id:"_2ã€leader-election"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2ã€leader-election"}},[e._v("#")]),e._v(" 2ã€leader election")]),e._v(" "),r("p",[e._v("raft åè®®ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä»»ä¸€æ—¶åˆ»å¤„äºä»¥ä¸‹ä¸‰ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("leader")]),e._v(" "),r("li",[e._v("follower")]),e._v(" "),r("li",[e._v("candidate")])]),e._v(" "),r("p",[e._v("ç»™å‡ºçŠ¶æ€è½¬ç§»å›¾èƒ½å¾ˆç›´è§‚çš„ç›´åˆ°è¿™ä¸‰ä¸ªçŠ¶æ€çš„åŒºåˆ«"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245852.png",alt:""}})]),e._v(" "),r("p",[e._v("å¯ä»¥çœ‹å‡ºæ‰€æœ‰èŠ‚ç‚¹å¯åŠ¨æ—¶éƒ½æ˜¯ follower çŠ¶æ€ï¼›åœ¨ä¸€æ®µæ—¶é—´å†…å¦‚æœæ²¡æœ‰æ”¶åˆ°æ¥è‡ª leader çš„å¿ƒè·³ï¼Œä» follower åˆ‡æ¢åˆ° candidateï¼Œå‘èµ·é€‰ä¸¾ï¼›å¦‚æœæ”¶åˆ° majority çš„é€ æˆç¥¨ï¼ˆå«è‡ªå·±çš„ä¸€ç¥¨ï¼‰åˆ™åˆ‡æ¢åˆ° leader çŠ¶æ€ï¼›å¦‚æœå‘ç°å…¶ä»–èŠ‚ç‚¹æ¯”è‡ªå·±æ›´æ–°ï¼Œåˆ™ä¸»åŠ¨åˆ‡æ¢åˆ° followerã€‚")]),e._v(" "),r("p",[e._v("æ€»ä¹‹ï¼Œç³»ç»Ÿä¸­æœ€å¤šåªæœ‰ä¸€ä¸ª leaderï¼Œå¦‚æœåœ¨ä¸€æ®µæ—¶é—´é‡Œå‘ç°æ²¡æœ‰ leaderï¼Œåˆ™å¤§å®¶é€šè¿‡é€‰ä¸¾ - æŠ•ç¥¨é€‰å‡º leaderã€‚leader ä¼šä¸åœçš„ç»™ follower å‘å¿ƒè·³æ¶ˆæ¯ï¼Œè¡¨æ˜è‡ªå·±çš„å­˜æ´»çŠ¶æ€ã€‚å¦‚æœ leader æ•…éšœï¼Œé‚£ä¹ˆ follower ä¼šè½¬æ¢æˆ candidateï¼Œé‡æ–°é€‰å‡º leaderã€‚")]),e._v(" "),r("h3",{attrs:{id:"term"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#term"}},[e._v("#")]),e._v(" term")]),e._v(" "),r("p",[e._v("ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œå“ªä¸ªèŠ‚ç‚¹åš leader æ˜¯å¤§å®¶æŠ•ç¥¨é€‰ä¸¾å‡ºæ¥çš„ï¼Œæ¯ä¸ª leader å·¥ä½œä¸€æ®µæ—¶é—´ï¼Œç„¶åé€‰å‡ºæ–°çš„ leader ç»§ç»­è´Ÿè´£ã€‚è¿™æ ¹æ°‘ä¸»ç¤¾ä¼šçš„é€‰ä¸¾å¾ˆåƒï¼Œæ¯ä¸€å±Šæ–°çš„å±¥èŒæœŸç§°ä¹‹ä¸ºä¸€å±Šä»»æœŸï¼Œåœ¨ raft åè®®ä¸­ï¼Œä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œå¯¹åº”çš„æœ¯è¯­å« "),r("em",[r("strong",[e._v("term")])]),e._v("ã€‚"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245446.png",alt:""}})]),e._v(" "),r("p",[e._v("termï¼ˆä»»æœŸï¼‰ä»¥é€‰ä¸¾ï¼ˆelectionï¼‰å¼€å§‹ï¼Œç„¶åå°±æ˜¯ä¸€æ®µæˆ–é•¿æˆ–çŸ­çš„ç¨³å®šå·¥ä½œæœŸï¼ˆnormal Operationï¼‰ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œä»»æœŸæ˜¯é€’å¢çš„ï¼Œè¿™å°±å……å½“äº†é€»è¾‘æ—¶é’Ÿçš„ä½œç”¨ï¼›å¦å¤–ï¼Œterm 3 å±•ç¤ºäº†ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯è¯´æ²¡æœ‰é€‰ä¸¾å‡º leader å°±ç»“æŸäº†ï¼Œç„¶åä¼šå‘èµ·æ–°çš„é€‰ä¸¾ï¼Œåé¢ä¼šè§£é‡Šè¿™ç§ "),r("em",[e._v("split vote")]),e._v(" çš„æƒ…å†µã€‚")]),e._v(" "),r("h3",{attrs:{id:"é€‰ä¸¾è¿‡ç¨‹è¯¦è§£"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#é€‰ä¸¾è¿‡ç¨‹è¯¦è§£"}},[e._v("#")]),e._v(" é€‰ä¸¾è¿‡ç¨‹è¯¦è§£")]),e._v(" "),r("p",[e._v("ä¸Šé¢å·²ç»è¯´è¿‡ï¼Œå¦‚æœ follower åœ¨ "),r("em",[e._v("election timeout")]),e._v(" å†…æ²¡æœ‰æ”¶åˆ°æ¥è‡ª leader çš„å¿ƒè·³ï¼Œï¼ˆä¹Ÿè®¸æ­¤æ—¶è¿˜æ²¡æœ‰é€‰å‡º leaderï¼Œå¤§å®¶éƒ½åœ¨ç­‰ï¼›ä¹Ÿè®¸ leader æŒ‚äº†ï¼›ä¹Ÿè®¸åªæ˜¯ leader ä¸è¯¥ follower ä¹‹é—´ç½‘ç»œæ•…éšœï¼‰ï¼Œåˆ™ä¼šä¸»åŠ¨å‘èµ·é€‰ä¸¾ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("å¢åŠ èŠ‚ç‚¹æœ¬åœ°çš„ "),r("em",[e._v("current term")]),e._v(" ï¼Œåˆ‡æ¢åˆ° candidate çŠ¶æ€")]),e._v(" "),r("li",[e._v("æŠ•è‡ªå·±ä¸€ç¥¨")]),e._v(" "),r("li",[e._v("å¹¶è¡Œç»™å…¶ä»–èŠ‚ç‚¹å‘é€ "),r("em",[e._v("RequestVote RPCs")])]),e._v(" "),r("li",[e._v("ç­‰å¾…å…¶ä»–èŠ‚ç‚¹çš„å›å¤")])]),e._v(" "),r("p",[e._v("åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„æ¶ˆæ¯ï¼Œå¯èƒ½å‡ºç°ä¸‰ç§ç»“æœ")]),e._v(" "),r("ol",[r("li",[e._v("æ”¶åˆ° majority çš„æŠ•ç¥¨ï¼ˆå«è‡ªå·±çš„ä¸€ç¥¨ï¼‰ï¼Œåˆ™èµ¢å¾—é€‰ä¸¾ï¼Œæˆä¸º leader")]),e._v(" "),r("li",[e._v("è¢«å‘ŠçŸ¥åˆ«äººå·²å½“é€‰ï¼Œé‚£ä¹ˆè‡ªè¡Œåˆ‡æ¢åˆ° follower")]),e._v(" "),r("li",[e._v("ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° majority æŠ•ç¥¨ï¼Œåˆ™ä¿æŒ candidate çŠ¶æ€ï¼Œé‡æ–°å‘å‡ºé€‰ä¸¾")])]),e._v(" "),r("p",[e._v("ç¬¬ä¸€ç§æƒ…å†µï¼Œèµ¢å¾—äº†é€‰ä¸¾ä¹‹åï¼Œæ–°çš„ leader ä¼šç«‹åˆ»ç»™æ‰€æœ‰èŠ‚ç‚¹å‘æ¶ˆæ¯ï¼Œå¹¿è€Œå‘Šä¹‹ï¼Œé¿å…å…¶ä½™èŠ‚ç‚¹è§¦å‘æ–°çš„é€‰ä¸¾ã€‚åœ¨è¿™é‡Œï¼Œå…ˆå›åˆ°æŠ•ç¥¨è€…çš„è§†è§’ï¼ŒæŠ•ç¥¨è€…å¦‚ä½•å†³å®šæ˜¯å¦ç»™ä¸€ä¸ªé€‰ä¸¾è¯·æ±‚æŠ•ç¥¨å‘¢ï¼Œæœ‰ä»¥ä¸‹çº¦æŸï¼š")]),e._v(" "),r("ul",[r("li",[e._v("åœ¨ä»»ä¸€ä»»æœŸå†…ï¼Œå•ä¸ªèŠ‚ç‚¹æœ€å¤šåªèƒ½æŠ•ä¸€ç¥¨")]),e._v(" "),r("li",[e._v("å€™é€‰äººçŸ¥é“çš„ä¿¡æ¯ä¸èƒ½æ¯”è‡ªå·±çš„å°‘ï¼ˆè¿™ä¸€éƒ¨åˆ†ï¼Œåé¢ä»‹ç» log replication å’Œ safety çš„æ—¶å€™ä¼šè¯¦ç»†ä»‹ç»ï¼‰")]),e._v(" "),r("li",[e._v("first-come-first-served å…ˆæ¥å…ˆå¾—")])]),e._v(" "),r("p",[e._v("ç¬¬äºŒç§æƒ…å†µï¼Œæ¯”å¦‚æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ A B Cã€‚A B åŒæ—¶å‘èµ·é€‰ä¸¾ï¼Œè€Œ A çš„é€‰ä¸¾æ¶ˆæ¯å…ˆåˆ°è¾¾ Cï¼ŒC ç»™ A æŠ•äº†ä¸€ç¥¨ï¼Œå½“ B çš„æ¶ˆæ¯åˆ°è¾¾ C æ—¶ï¼Œå·²ç»ä¸èƒ½æ»¡è¶³ä¸Šé¢æåˆ°çš„ç¬¬ä¸€ä¸ªçº¦æŸï¼Œå³ C ä¸ä¼šç»™ B æŠ•ç¥¨ï¼Œè€Œ A å’Œ B æ˜¾ç„¶éƒ½ä¸ä¼šç»™å¯¹æ–¹æŠ•ç¥¨ã€‚A èƒœå‡ºä¹‹åï¼Œä¼šç»™ B,C å‘å¿ƒè·³æ¶ˆæ¯ï¼ŒèŠ‚ç‚¹ B å‘ç°èŠ‚ç‚¹ A çš„ term ä¸ä½äºè‡ªå·±çš„ termï¼ŒçŸ¥é“æœ‰å·²ç»æœ‰ Leader äº†ï¼Œäºæ˜¯è½¬æ¢æˆ followerã€‚")]),e._v(" "),r("p",[e._v("ç¬¬ä¸‰ç§æƒ…å†µï¼Œæ²¡æœ‰ä»»ä½•èŠ‚ç‚¹è·å¾— majority æŠ•ç¥¨ï¼Œæ¯”å¦‚ä¸‹å›¾è¿™ç§æƒ…å†µï¼š"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245368.png",alt:""}})]),e._v(" "),r("p",[e._v("æ€»å…±æœ‰å››ä¸ªèŠ‚ç‚¹ï¼ŒNode Cã€Node D åŒæ—¶æˆä¸ºäº† candidateï¼Œè¿›å…¥äº† term 4ï¼Œä½† Node A æŠ•äº† NodeD ä¸€ç¥¨ï¼ŒNodeB æŠ•äº† Node C ä¸€ç¥¨ï¼Œè¿™å°±å‡ºç°äº†å¹³ç¥¨ split vote çš„æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™å¤§å®¶éƒ½åœ¨ç­‰å•Šç­‰ï¼Œç›´åˆ°è¶…æ—¶åé‡æ–°å‘èµ·é€‰ä¸¾ã€‚å¦‚æœå‡ºç°å¹³ç¥¨çš„æƒ…å†µï¼Œé‚£ä¹ˆå°±å»¶é•¿äº†ç³»ç»Ÿä¸å¯ç”¨çš„æ—¶é—´ï¼ˆæ²¡æœ‰ leader æ˜¯ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯å†™è¯·æ±‚çš„ï¼‰ï¼Œå› æ­¤ raft å¼•å…¥äº† randomized election timeouts æ¥å°½é‡é¿å…å¹³ç¥¨æƒ…å†µã€‚åŒæ—¶ï¼Œleader-based å…±è¯†ç®—æ³•ä¸­ï¼ŒèŠ‚ç‚¹çš„æ•°ç›®éƒ½æ˜¯å¥‡æ•°ä¸ªï¼Œå°½é‡ä¿è¯ majority çš„å‡ºç°ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_3ã€log-replication"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3ã€log-replication"}},[e._v("#")]),e._v(" 3ã€log replication")]),e._v(" "),r("p",[e._v("å½“æœ‰äº† leaderï¼Œç³»ç»Ÿåº”è¯¥è¿›å…¥å¯¹å¤–å·¥ä½œæœŸäº†ã€‚å®¢æˆ·ç«¯çš„ä¸€åˆ‡è¯·æ±‚æ¥å‘é€åˆ° leaderï¼Œleader æ¥è°ƒåº¦è¿™äº›å¹¶å‘è¯·æ±‚çš„é¡ºåºï¼Œå¹¶ä¸”ä¿è¯ leader ä¸ followers çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚raft ä¸­çš„åšæ³•æ˜¯ï¼Œå°†è¿™äº›è¯·æ±‚ä»¥åŠæ‰§è¡Œé¡ºåºå‘ŠçŸ¥ followersã€‚leader å’Œ followers ä»¥ç›¸åŒçš„é¡ºåºæ¥æ‰§è¡Œè¿™äº›è¯·æ±‚ï¼Œä¿è¯çŠ¶æ€ä¸€è‡´ã€‚")]),e._v(" "),r("h3",{attrs:{id:"replicated-state-machines"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#replicated-state-machines"}},[e._v("#")]),e._v(" Replicated state machines")]),e._v(" "),r("p",[e._v("å…±è¯†ç®—æ³•çš„å®ç°ä¸€èˆ¬æ˜¯åŸºäºå¤åˆ¶çŠ¶æ€æœºï¼ˆReplicated state machinesï¼‰ï¼Œä½•ä¸ºå¤åˆ¶çŠ¶æ€æœºï¼š")]),e._v(" "),r("blockquote",[r("p",[e._v("If two identical, "),r("strong",[e._v("deterministic")]),e._v(" processes begin in the same state and get the same inputs in the same order, they will produce the same output and end in the same state.")])]),e._v(" "),r("p",[e._v("ç®€å•æ¥è¯´ï¼š"),r("strong",[e._v("ç›¸åŒçš„åˆè¯†çŠ¶æ€ + ç›¸åŒçš„è¾“å…¥ = ç›¸åŒçš„ç»“æŸçŠ¶æ€")]),e._v("ã€‚å¼•æ–‡ä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„è¯"),r("code",[e._v("deterministic")]),e._v("ï¼Œå°±æ˜¯è¯´ä¸åŒèŠ‚ç‚¹è¦ä»¥ç›¸åŒä¸”ç¡®å®šæ€§çš„å‡½æ•°æ¥å¤„ç†è¾“å…¥ï¼Œè€Œä¸è¦å¼•å…¥ä¸€ä¸‹ä¸ç¡®å®šçš„å€¼ï¼Œæ¯”å¦‚æœ¬åœ°æ—¶é—´ç­‰ã€‚å¦‚ä½•ä¿è¯æ‰€æœ‰èŠ‚ç‚¹ "),r("code",[e._v("get the same inputs in the same order")]),e._v("ï¼Œä½¿ç”¨ replicated log æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„æ³¨æ„ï¼Œlog å…·æœ‰æŒä¹…åŒ–ã€ä¿åºçš„ç‰¹ç‚¹ï¼Œæ˜¯å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³ã€‚")]),e._v(" "),r("p",[e._v("å› æ­¤ï¼Œå¯ä»¥è¿™ä¹ˆè¯´ï¼Œåœ¨ raft ä¸­ï¼Œleader å°†å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆcommandï¼‰å°è£…åˆ°ä¸€ä¸ªä¸ª log entryï¼Œå°†è¿™äº› log entries å¤åˆ¶ï¼ˆreplicateï¼‰åˆ°æ‰€æœ‰ follower èŠ‚ç‚¹ï¼Œç„¶åå¤§å®¶æŒ‰ç›¸åŒé¡ºåºåº”ç”¨ï¼ˆapplyï¼‰log entry ä¸­çš„ commandï¼Œåˆ™çŠ¶æ€è‚¯å®šæ˜¯ä¸€è‡´çš„ã€‚")]),e._v(" "),r("p",[e._v("ä¸‹å›¾å½¢è±¡å±•ç¤ºäº†è¿™ç§ log-based replicated state machine"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245321.png",alt:""}})]),e._v(" "),r("h3",{attrs:{id:"è¯·æ±‚å®Œæ•´æµç¨‹"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚å®Œæ•´æµç¨‹"}},[e._v("#")]),e._v(" è¯·æ±‚å®Œæ•´æµç¨‹")]),e._v(" "),r("p",[e._v("å½“ç³»ç»Ÿï¼ˆleaderï¼‰æ”¶åˆ°ä¸€ä¸ªæ¥è‡ªå®¢æˆ·ç«¯çš„å†™è¯·æ±‚ï¼Œåˆ°è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ•´ä¸ªè¿‡ç¨‹ä» leader çš„è§†è§’æ¥çœ‹ä¼šç»å†ä»¥ä¸‹æ­¥éª¤ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("leader append log entry")]),e._v(" "),r("li",[e._v("leader issue AppendEntries RPC in parallel")]),e._v(" "),r("li",[e._v("leader wait for majority response")]),e._v(" "),r("li",[e._v("leader apply entry to state machine")]),e._v(" "),r("li",[e._v("leader reply to client")]),e._v(" "),r("li",[e._v("leader notify follower apply log")])]),e._v(" "),r("p",[e._v("å¯ä»¥çœ‹åˆ°æ—¥å¿—çš„æäº¤è¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼ä¸¤é˜¶æ®µæäº¤ (2PC)ï¼Œä¸è¿‡ä¸ 2PC çš„åŒºåˆ«åœ¨äºï¼Œleader åªéœ€è¦å¤§å¤šæ•°ï¼ˆmajorityï¼‰èŠ‚ç‚¹çš„å›å¤å³å¯ï¼Œè¿™æ ·åªè¦è¶…è¿‡ä¸€åŠèŠ‚ç‚¹å¤„äºå·¥ä½œçŠ¶æ€åˆ™ç³»ç»Ÿå°±æ˜¯å¯ç”¨çš„ã€‚")]),e._v(" "),r("p",[e._v("é‚£ä¹ˆæ—¥å¿—åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245795.png",alt:""}})]),e._v(" "),r("p",[e._v("ä¸éš¾çœ‹åˆ°ï¼Œlogs ç”±é¡ºåºç¼–å·çš„ log entry ç»„æˆ ï¼Œæ¯ä¸ª log entry é™¤äº†åŒ…å« commandï¼Œè¿˜åŒ…å«äº§ç”Ÿè¯¥ log entry æ—¶çš„ leader termã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œäº”ä¸ªèŠ‚ç‚¹çš„æ—¥å¿—å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œraft ç®—æ³•ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œå¹¶ä¸æ˜¯å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œleader ä¼šä¸æ–­å°è¯•ç»™ follower å‘ log entriesï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ log entries éƒ½ç›¸åŒã€‚")]),e._v(" "),r("p",[e._v("åœ¨ä¸Šé¢çš„æµç¨‹ä¸­ï¼Œleader åªéœ€è¦æ—¥å¿—è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹å³å¯å‘å®¢æˆ·ç«¯è¿”å›ï¼Œä¸€æ—¦å‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸæ¶ˆæ¯ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¿…é¡»ä¿è¯ logï¼ˆå…¶å®æ˜¯ log æ‰€åŒ…å«çš„ commandï¼‰åœ¨ä»»ä½•å¼‚å¸¸çš„æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘ç”Ÿå›æ»šã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªè¯ï¼šcommitï¼ˆcommittedï¼‰ï¼Œapply(applied)ï¼Œå‰è€…æ˜¯æŒ‡æ—¥å¿—è¢«å¤åˆ¶åˆ°äº†å¤§å¤šæ•°èŠ‚ç‚¹åæ—¥å¿—çš„çŠ¶æ€ï¼›è€Œåè€…åˆ™æ˜¯èŠ‚ç‚¹å°†æ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºï¼ŒçœŸæ­£å½±å“åˆ°èŠ‚ç‚¹çŠ¶æ€ã€‚")]),e._v(" "),r("blockquote",[r("p",[e._v("The leader decides when it is safe to apply a log entry to the state machines; such an entry is called committed. Raft guarantees that committed entries are durable and will eventually be executed by all of the available state machines. A log entry is committed once the leader that created the entry has replicated it on a majority of the servers")])]),e._v(" "),r("h2",{attrs:{id:"_4ã€safety"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4ã€safety"}},[e._v("#")]),e._v(" 4ã€safety")]),e._v(" "),r("p",[e._v("åœ¨ä¸Šé¢æåˆ°åªè¦æ—¥å¿—è¢«å¤åˆ¶åˆ° majority èŠ‚ç‚¹ï¼Œå°±èƒ½ä¿è¯ä¸ä¼šè¢«å›æ»šï¼Œå³ä½¿åœ¨å„ç§å¼‚å¸¸æƒ…å†µä¸‹ï¼Œè¿™æ ¹ leader election æåˆ°çš„é€‰ä¸¾çº¦æŸæœ‰å…³ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œä¸»è¦è®¨è®º raft åè®®åœ¨å„ç§å„æ ·çš„å¼‚å¸¸æƒ…å†µä¸‹å¦‚ä½•å·¥ä½œçš„ã€‚")]),e._v(" "),r("p",[e._v("è¡¡é‡ä¸€ä¸ªåˆ†å¸ƒå¼ç®—æ³•ï¼Œæœ‰è®¸å¤šå±æ€§ï¼Œå¦‚")]),e._v(" "),r("ul",[r("li",[e._v("safetyï¼šnothing bad happens,")]),e._v(" "),r("li",[e._v("livenessï¼š something good eventually happens.")])]),e._v(" "),r("p",[e._v("åœ¨ä»»ä½•ç³»ç»Ÿæ¨¡å‹ä¸‹ï¼Œéƒ½éœ€è¦æ»¡è¶³ safety å±æ€§ï¼Œå³åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œç³»ç»Ÿéƒ½ä¸èƒ½å‡ºç°ä¸å¯é€†çš„é”™è¯¯ï¼Œä¹Ÿä¸èƒ½å‘å®¢æˆ·ç«¯è¿”å›é”™è¯¯çš„å†…å®¹ã€‚æ¯”å¦‚ï¼Œraft ä¿è¯è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„æ—¥å¿—ä¸ä¼šè¢«å›æ»šï¼Œé‚£ä¹ˆå°±æ˜¯ safety å±æ€§ã€‚è€Œ raft æœ€ç»ˆä¼šè®©æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´ï¼Œè¿™å±äº liveness å±æ€§ã€‚")]),e._v(" "),r("p",[e._v("raft åè®®ä¼šä¿è¯ä»¥ä¸‹å±æ€§"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245235.png",alt:""}})]),e._v(" "),r("h3",{attrs:{id:"election-safety"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#election-safety"}},[e._v("#")]),e._v(" Election safety")]),e._v(" "),r("p",[e._v("é€‰ä¸¾å®‰å…¨æ€§ï¼Œå³ä»»ä¸€ä»»æœŸå†…æœ€å¤šä¸€ä¸ª leader è¢«é€‰å‡ºã€‚è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œåœ¨ä¸€ä¸ªå¤åˆ¶é›†ä¸­ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ª leaderã€‚ç³»ç»Ÿä¸­åŒæ—¶æœ‰å¤šä½™ä¸€ä¸ª leaderï¼Œè¢«ç§°ä¹‹ä¸ºè„‘è£‚ï¼ˆbrain splitï¼‰ï¼Œè¿™æ˜¯éå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œä¼šå¯¼è‡´æ•°æ®çš„è¦†ç›–ä¸¢å¤±ã€‚åœ¨ raft ä¸­ï¼Œä¸¤ç‚¹ä¿è¯äº†è¿™ä¸ªå±æ€§ï¼š")]),e._v(" "),r("ul",[r("li",[e._v("ä¸€ä¸ªèŠ‚ç‚¹æŸä¸€ä»»æœŸå†…æœ€å¤šåªèƒ½æŠ•ä¸€ç¥¨ï¼›")]),e._v(" "),r("li",[e._v("åªæœ‰è·å¾— majority æŠ•ç¥¨çš„èŠ‚ç‚¹æ‰ä¼šæˆä¸º leaderã€‚")])]),e._v(" "),r("p",[e._v("å› æ­¤ï¼Œ"),r("strong",[e._v("æŸä¸€ä»»æœŸå†…ä¸€å®šåªæœ‰ä¸€ä¸ª leader")]),e._v("ã€‚")]),e._v(" "),r("h3",{attrs:{id:"log-matching"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#log-matching"}},[e._v("#")]),e._v(" log matching")]),e._v(" "),r("p",[e._v("å¾ˆæœ‰æ„æ€ï¼Œlog åŒ¹é…ç‰¹æ€§ï¼Œ å°±æ˜¯è¯´å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ä¸Šçš„æŸä¸ª log entry çš„ log index ç›¸åŒä¸” term ç›¸åŒï¼Œé‚£ä¹ˆåœ¨è¯¥ index ä¹‹å‰çš„æ‰€æœ‰ log entry åº”è¯¥éƒ½æ˜¯ç›¸åŒçš„ã€‚å¦‚ä½•åšåˆ°çš„ï¼Ÿä¾èµ–äºä»¥ä¸‹ä¸¤ç‚¹")]),e._v(" "),r("ul",[r("li",[e._v("If two entries in different logs have the same index and term, then they store the same command.")]),e._v(" "),r("li",[e._v("If two entries in different logs have the same index and term, then the logs are identical in all preceding entries.")])]),e._v(" "),r("p",[e._v("é¦–å…ˆï¼Œleader åœ¨æŸä¸€ term çš„ä»»ä¸€ä½ç½®åªä¼šåˆ›å»ºä¸€ä¸ª log entryï¼Œä¸” log entry æ˜¯ append-onlyã€‚å…¶æ¬¡ï¼Œconsistency checkã€‚leader åœ¨ AppendEntries ä¸­åŒ…å«æœ€æ–° log entry ä¹‹å‰çš„ä¸€ä¸ª log çš„ term å’Œ indexï¼Œå¦‚æœ follower åœ¨å¯¹åº”çš„ term index æ‰¾ä¸åˆ°æ—¥å¿—ï¼Œé‚£ä¹ˆå°±ä¼šå‘ŠçŸ¥ leader ä¸ä¸€è‡´ã€‚")]),e._v(" "),r("p",[e._v("åœ¨æ²¡æœ‰å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œlog matching æ˜¯å¾ˆå®¹æ˜“æ»¡è¶³çš„ï¼Œä½†å¦‚æœå‡ºç°äº† node crashï¼Œæƒ…å†µå°±ä¼šå˜å¾—è´Ÿè´£ã€‚æ¯”å¦‚ä¸‹å›¾"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245788.png",alt:""}})]),e._v(" "),r("p",[r("strong",[e._v("æ³¨æ„")]),e._v("ï¼šä¸Šå›¾çš„ a-f ä¸æ˜¯ 6 ä¸ª followerï¼Œè€Œæ˜¯æŸä¸ª follower å¯èƒ½å­˜åœ¨çš„å…­ä¸ªçŠ¶æ€")]),e._v(" "),r("p",[e._v("leaderã€follower éƒ½å¯èƒ½ crashï¼Œé‚£ä¹ˆ follower ç»´æŠ¤çš„æ—¥å¿—ä¸ leader ç›¸æ¯”å¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µ")]),e._v(" "),r("ul",[r("li",[e._v("æ¯” leader æ—¥å¿—å°‘ï¼Œå¦‚ä¸Šå›¾ä¸­çš„ ab")]),e._v(" "),r("li",[e._v("æ¯” leader æ—¥å¿—å¤šï¼Œå¦‚ä¸Šå›¾ä¸­çš„ cd")]),e._v(" "),r("li",[e._v("æŸäº›ä½ç½®æ¯” leader å¤šï¼ŒæŸäº›æ—¥å¿—æ¯” leader å°‘ï¼Œå¦‚ efï¼ˆå¤šå°‘æ˜¯é’ˆå¯¹æŸä¸€ä»»æœŸè€Œè¨€ï¼‰")])]),e._v(" "),r("p",[e._v("å½“å‡ºç°äº† leader ä¸ follower ä¸ä¸€è‡´çš„æƒ…å†µï¼Œleader å¼ºåˆ¶ follower å¤åˆ¶è‡ªå·±çš„ log")]),e._v(" "),r("blockquote",[r("p",[e._v("To bring a followerâ€™s log into consistency with its own, the leader must find the latest log entry where the two logs agree, delete any entries in the followerâ€™s log after that point, and send the follower all of the leaderâ€™s entries after that point.")])]),e._v(" "),r("p",[e._v("leader ä¼šç»´æŠ¤ä¸€ä¸ª nextIndex[] æ•°ç»„ï¼Œè®°å½•äº† leader å¯ä»¥å‘é€æ¯ä¸€ä¸ª follower çš„ log indexï¼Œåˆå§‹åŒ–ä¸º leader æœ€åä¸€ä¸ª log index åŠ  1ï¼Œ å‰é¢ä¹Ÿæåˆ°ï¼Œleader é€‰ä¸¾æˆåŠŸä¹‹åä¼šç«‹å³ç»™æ‰€æœ‰ follower å‘é€ AppendEntries RPCï¼ˆä¸åŒ…å«ä»»ä½• log entryï¼Œ ä¹Ÿå……å½“å¿ƒè·³æ¶ˆæ¯ï¼‰, é‚£ä¹ˆæµç¨‹æ€»ç»“ä¸ºï¼š")]),e._v(" "),r("blockquote",[r("p",[e._v("s1 leader åˆå§‹åŒ– nextIndex[x] ä¸º leader æœ€åä¸€ä¸ª log index + 1"),r("br"),e._v("\ns2 AppendEntries é‡Œ prevLogTerm prevLogIndex æ¥è‡ª logs[nextIndex[x] - 1]"),r("br"),e._v("\ns3 å¦‚æœ follower åˆ¤æ–­ prevLogIndex ä½ç½®çš„ log term ä¸ç­‰äº prevLogTermï¼Œé‚£ä¹ˆè¿”å› Falseï¼Œå¦åˆ™è¿”å› True"),r("br"),e._v("\ns4 leader æ”¶åˆ° follower çš„å›å¤ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ Falseï¼Œåˆ™ nextIndex[x] -= 1, è·³è½¬åˆ° s2. å¦åˆ™"),r("br"),e._v("\ns5 åŒæ­¥ nextIndex[x] åçš„æ‰€æœ‰ log entries")])]),e._v(" "),r("h3",{attrs:{id:"leader-completeness-vs-elcetion-restriction"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#leader-completeness-vs-elcetion-restriction"}},[e._v("#")]),e._v(" leader completeness vs elcetion restriction")]),e._v(" "),r("p",[e._v("leader å®Œæ•´æ€§ï¼šå¦‚æœä¸€ä¸ª log entry åœ¨æŸä¸ªä»»æœŸè¢«æäº¤ï¼ˆcommittedï¼‰ï¼Œé‚£ä¹ˆè¿™æ¡æ—¥å¿—ä¸€å®šä¼šå‡ºç°åœ¨æ‰€æœ‰æ›´é«˜ term çš„ leader çš„æ—¥å¿—é‡Œé¢ã€‚è¿™ä¸ªè·Ÿ leader electionã€log replication éƒ½æœ‰å…³ã€‚")]),e._v(" "),r("ul",[r("li",[e._v("ä¸€ä¸ªæ—¥å¿—è¢«å¤åˆ¶åˆ° majority èŠ‚ç‚¹æ‰ç®— committed")]),e._v(" "),r("li",[e._v("ä¸€ä¸ªèŠ‚ç‚¹å¾—åˆ° majority çš„æŠ•ç¥¨æ‰èƒ½æˆä¸º leaderï¼Œè€ŒèŠ‚ç‚¹ A ç»™èŠ‚ç‚¹ B æŠ•ç¥¨çš„å…¶ä¸­ä¸€ä¸ªå‰ææ˜¯ï¼ŒB çš„æ—¥å¿—ä¸èƒ½æ¯” A çš„æ—¥å¿—æ—§ã€‚ä¸‹é¢çš„å¼•æ–‡æŒ‡å¤„äº†å¦‚ä½•åˆ¤æ–­æ—¥å¿—çš„æ–°æ—§")])]),e._v(" "),r("blockquote",[r("p",[e._v("voter denies its vote if its own log is more up-to-date than that of the candidate.")])]),e._v(" "),r("blockquote",[r("p",[e._v("If the logs have last entries with different terms, then the log with the later term is more up-to-date. If the logs end with the same term, then whichever log is longer is more up-to-date.")])]),e._v(" "),r("p",[e._v("ä¸Šé¢ä¸¤ç‚¹éƒ½æåˆ°äº† majorityï¼šcommit majority and vote majorityï¼Œæ ¹æ® Quorumï¼Œè¿™ä¸¤ä¸ª majority ä¸€å®šæ˜¯æœ‰é‡åˆçš„ï¼Œå› æ­¤è¢«é€‰ä¸¾å‡ºçš„ leader ä¸€å®šåŒ…å«äº†æœ€æ–°çš„ committed çš„æ—¥å¿—ã€‚")]),e._v(" "),r("p",[e._v("raft ä¸å…¶ä»–åè®®ï¼ˆViewstamped Replicationã€mongodbï¼‰ä¸åŒï¼Œraft å§‹ç»ˆä¿è¯ leader åŒ…å«æœ€æ–°çš„å·²æäº¤çš„æ—¥å¿—ï¼Œå› æ­¤ leader ä¸ä¼šä» follower catchup æ—¥å¿—ï¼Œè¿™ä¹Ÿå¤§å¤§ç®€åŒ–äº†ç³»ç»Ÿçš„å¤æ‚åº¦ã€‚")]),e._v(" "),r("h2",{attrs:{id:"_5ã€corner-case"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5ã€corner-case"}},[e._v("#")]),e._v(" 5ã€corner case")]),e._v(" "),r("p",[e._v("stale leader")]),e._v(" "),r("p",[e._v("raft ä¿è¯ Election safetyï¼Œå³ä¸€ä¸ªä»»æœŸå†…æœ€å¤šåªæœ‰ä¸€ä¸ª leaderï¼Œä½†åœ¨ç½‘ç»œåˆ†å‰²ï¼ˆnetwork partitionï¼‰çš„æƒ…å†µä¸‹ï¼Œ"),r("strong",[e._v("å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ª leaderï¼Œä½†ä¸¤ä¸ª leader æ‰€å¤„çš„ä»»æœŸæ˜¯ä¸åŒçš„")]),e._v("ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245777.png",alt:""}})]),e._v(" "),r("p",[e._v("ç³»ç»Ÿæœ‰ 5 ä¸ªèŠ‚ç‚¹ ABCDE ç»„æˆï¼Œåœ¨ term1ï¼ŒNode B æ˜¯ leaderï¼Œä½† Node Aã€B å’Œ Node Cã€Dã€E ä¹‹é—´å‡ºç°äº†ç½‘ç»œåˆ†å‰²ï¼Œå› æ­¤ Node Cã€Dã€E æ— æ³•æ”¶åˆ°æ¥è‡ª leaderï¼ˆNode Bï¼‰çš„æ¶ˆæ¯ï¼Œåœ¨ election time ä¹‹åï¼ŒNode Cã€Dã€E ä¼šåˆ†æœŸé€‰ä¸¾ï¼Œç”±äºæ»¡è¶³ majority æ¡ä»¶ï¼ŒNode E æˆä¸ºäº† term 2 çš„ leaderã€‚å› æ­¤ï¼Œåœ¨ç³»ç»Ÿä¸­è²Œä¼¼å‡ºç°äº†ä¸¤ä¸ª leaderï¼šterm 1 çš„ Node Bï¼Œ term 2 çš„ Node E, Node B çš„ term æ›´æ—§ï¼Œä½†ç”±äºæ— æ³•ä¸ Majority èŠ‚ç‚¹é€šä¿¡ï¼ŒNodeB ä»ç„¶ä¼šè®¤ä¸ºè‡ªå·±æ˜¯ leaderã€‚")]),e._v(" "),r("p",[e._v("åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¥è€ƒè™‘è¯»å†™ã€‚")]),e._v(" "),r("p",[e._v("é¦–å…ˆï¼Œå¦‚æœå®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€åˆ°äº† NodeBï¼ŒNodeB æ— æ³•å°† log entry å¤åˆ¶åˆ° majority èŠ‚ç‚¹ï¼Œå› æ­¤ä¸ä¼šå‘Šè¯‰å®¢æˆ·ç«¯å†™å…¥æˆåŠŸï¼Œè¿™å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚")]),e._v(" "),r("p",[e._v("å¯¹äºè¯»è¯·æ±‚ï¼Œstale leader å¯èƒ½è¿”å› stale dataï¼Œæ¯”å¦‚åœ¨ read-after-write çš„ä¸€è‡´æ€§è¦æ±‚ä¸‹ï¼Œå®¢æˆ·ç«¯å†™å…¥åˆ°äº† term2 ä»»æœŸçš„ leader Node Eï¼Œä½†è¯»è¯·æ±‚å‘é€åˆ°äº† Node Bã€‚å¦‚æœè¦ä¿è¯ä¸è¿”å› stale dataï¼Œleader éœ€è¦ check è‡ªå·±æ˜¯å¦è¿‡æ—¶äº†ï¼ŒåŠæ³•å°±æ˜¯ä¸å¤§å¤šæ•°èŠ‚ç‚¹é€šä¿¡ä¸€æ¬¡ï¼Œè¿™ä¸ªå¯èƒ½ä¼šå‡ºç°æ•ˆç‡é—®é¢˜ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ leaseï¼Œä½†è¿™å°±ä¼šä¾èµ–ç‰©ç†æ—¶é’Ÿã€‚")]),e._v(" "),r("p",[e._v("ä» raft çš„è®ºæ–‡ä¸­å¯ä»¥çœ‹åˆ°ï¼Œleader è½¬æ¢æˆ follower çš„æ¡ä»¶æ˜¯æ”¶åˆ°æ¥è‡ªæ›´é«˜ term çš„æ¶ˆæ¯ï¼Œå¦‚æœç½‘ç»œåˆ†å‰²ä¸€ç›´æŒç»­ï¼Œé‚£ä¹ˆ stale leader å°±ä¼šä¸€ç›´å­˜åœ¨ã€‚è€Œåœ¨ raft çš„ä¸€äº›å®ç°æˆ–è€… raft-like åè®®ä¸­ï¼Œleader å¦‚æœæ”¶ä¸åˆ° majority èŠ‚ç‚¹çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¯ä»¥è‡ªå·± step downï¼Œè‡ªè¡Œè½¬æ¢åˆ° follower çŠ¶æ€ã€‚")]),e._v(" "),r("h3",{attrs:{id:"state-machine-safety"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#state-machine-safety"}},[e._v("#")]),e._v(" State Machine Safety")]),e._v(" "),r("p",[e._v("å‰é¢åœ¨ä»‹ç» safety çš„æ—¶å€™æœ‰ä¸€æ¡å±æ€§æ²¡æœ‰è¯¦ç»†ä»‹ç»ï¼Œé‚£å°±æ˜¯ State Machine Safetyï¼š")]),e._v(" "),r("blockquote",[r("p",[e._v("State Machine Safety: if a server has applied a log entry at a given index to its state machine, no other server will ever apply a different log entry for the same index.")])]),e._v(" "),r("p",[e._v("å¦‚æœèŠ‚ç‚¹å°†æŸä¸€ä½ç½®çš„ log entry åº”ç”¨åˆ°äº†çŠ¶æ€æœºï¼Œé‚£ä¹ˆå…¶ä»–èŠ‚ç‚¹åœ¨åŒä¸€ä½ç½®ä¸èƒ½åº”ç”¨ä¸åŒçš„æ—¥å¿—ã€‚ç®€å•ç‚¹æ¥è¯´ï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€ä½ç½®ï¼ˆindex in log entriesï¼‰åº”è¯¥åº”ç”¨åŒæ ·çš„æ—¥å¿—ã€‚ä½†æ˜¯ä¼¼ä¹æœ‰æŸäº›æƒ…å†µä¼šè¿èƒŒè¿™ä¸ªåŸåˆ™ï¼š"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245596.png",alt:""}})]),e._v(" "),r("p",[e._v("ä¸Šå›¾æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„æƒ…å†µã€‚åœ¨æ—¶åˆ» (a), s1 æ˜¯ leaderï¼Œåœ¨ term2 æäº¤çš„æ—¥å¿—åªèµ‹å€¼åˆ°äº† s1 s2 ä¸¤ä¸ªèŠ‚ç‚¹å°± crash äº†ã€‚åœ¨æ—¶åˆ»ï¼ˆb), s5 æˆä¸ºäº† term 3 çš„ leaderï¼Œæ—¥å¿—åªèµ‹å€¼åˆ°äº† s5ï¼Œç„¶å crashã€‚ç„¶ååœ¨(c) æ—¶åˆ»ï¼Œs1 åˆæˆä¸ºäº† term 4 çš„ leaderï¼Œå¼€å§‹èµ‹å€¼æ—¥å¿—ï¼Œäºæ˜¯æŠŠ term2 çš„æ—¥å¿—å¤åˆ¶åˆ°äº† s3ï¼Œæ­¤åˆ»ï¼Œå¯ä»¥çœ‹å‡º term2 å¯¹åº”çš„æ—¥å¿—å·²ç»è¢«å¤åˆ¶åˆ°äº† majorityï¼Œå› æ­¤æ˜¯ committedï¼Œå¯ä»¥è¢«çŠ¶æ€æœºåº”ç”¨ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ¥ä¸‹æ¥ï¼ˆdï¼‰æ—¶åˆ»ï¼Œs1 åˆ crash äº†ï¼Œs5 é‡æ–°å½“é€‰ï¼Œç„¶åå°† term3 çš„æ—¥å¿—å¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿™å°±å‡ºç°äº†ä¸€ç§å¥‡æ€ªçš„ç°è±¡ï¼šè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ï¼ˆæˆ–è€…è¯´å¯èƒ½å·²ç»åº”ç”¨ï¼‰çš„æ—¥å¿—è¢«å›æ»šã€‚")]),e._v(" "),r("p",[e._v("ç©¶å…¶æ ¹æœ¬ï¼Œæ˜¯å› ä¸º term4 æ—¶çš„ leader s1 åœ¨ï¼ˆCï¼‰æ—¶åˆ»æäº¤äº†ä¹‹å‰ term2 ä»»æœŸçš„æ—¥å¿—ã€‚ä¸ºäº†æœç»è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼š")]),e._v(" "),r("blockquote",[r("p",[r("strong",[e._v("Raft never commits log entries from previous terms by counting replicas")]),e._v("."),r("br"),e._v("\nOnly log entries from the leaderâ€™s current term are committed by counting replicas; once an entry from the current term has been committed in this way, then all prior entries are committed indirectly because of the Log Matching Property.")])]),e._v(" "),r("p",[e._v("ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸ª leader é€‰ä¸¾æˆåŠŸä¹‹åï¼Œä¸ä¼šç›´æ¥æäº¤å‰ä»» leader æ—¶æœŸçš„æ—¥å¿—ï¼Œè€Œæ˜¯é€šè¿‡æäº¤å½“å‰ä»»æœŸçš„æ—¥å¿—çš„æ—¶å€™ â€œé¡ºæ‰‹â€ æŠŠä¹‹å‰çš„æ—¥å¿—ä¹Ÿæäº¤äº†ï¼Œå…·ä½“æ€ä¹ˆå®ç°äº†ï¼Œåœ¨ log matching éƒ¨åˆ†æœ‰è¯¦ç»†ä»‹ç»ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœ leader è¢«é€‰ä¸¾åæ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚å‘¢ï¼Œè®ºæ–‡ä¸­æœ‰æåˆ°ï¼Œåœ¨ä»»æœŸå¼€å§‹çš„æ—¶å€™å‘ç«‹å³å°è¯•å¤åˆ¶ã€æäº¤ä¸€æ¡ç©ºçš„ log")]),e._v(" "),r("blockquote",[r("p",[e._v("Raft handles this by having each leader commit a blank no-op entry into the log at the start of its term.")])]),e._v(" "),r("p",[e._v("å› æ­¤ï¼Œåœ¨ä¸Šå›¾ä¸­ï¼Œä¸ä¼šå‡ºç°ï¼ˆCï¼‰æ—¶åˆ»çš„æƒ…å†µï¼Œå³ term4 ä»»æœŸçš„ leader s1 ä¸ä¼šå¤åˆ¶ term2 çš„æ—¥å¿—åˆ° s3ã€‚è€Œæ˜¯å¦‚åŒ (e) æè¿°çš„æƒ…å†µï¼Œé€šè¿‡å¤åˆ¶ - æäº¤ term4 çš„æ—¥å¿—é¡ºä¾¿æäº¤ term2 çš„æ—¥å¿—ã€‚å¦‚æœ term4 çš„æ—¥å¿—æäº¤æˆåŠŸï¼Œé‚£ä¹ˆ term2 çš„æ—¥å¿—ä¹Ÿä¸€å®šæäº¤æˆåŠŸï¼Œæ­¤æ—¶å³ä½¿ s1crashï¼Œs5 ä¹Ÿä¸ä¼šé‡æ–°å½“é€‰ã€‚")]),e._v(" "),r("h3",{attrs:{id:"leader-crash"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#leader-crash"}},[e._v("#")]),e._v(" leader crash")]),e._v(" "),r("p",[e._v("follower çš„ crash å¤„ç†æ–¹å¼ç›¸å¯¹ç®€å•ï¼Œleader åªè¦ä¸åœçš„ç»™ follower å‘æ¶ˆæ¯å³å¯ã€‚å½“ leader crash çš„æ—¶å€™ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—å¤æ‚ã€‚åœ¨"),r("a",{attrs:{href:"http://www.cnblogs.com/mindwind/p/5231986.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("è¿™ç¯‡æ–‡ç« "),r("OutboundLink")],1),e._v("ä¸­ï¼Œä½œè€…å°±ç»™å‡ºäº†ä¸€ä¸ªæ›´æ–°è¯·æ±‚çš„æµç¨‹å›¾ã€‚"),r("br"),e._v(" "),r("img",{attrs:{src:"http://oss.interviewguide.cn/img/202206222245472.png",alt:""}}),e._v("  \tæˆ‘ä»¬å¯ä»¥åˆ†æ leader åœ¨ä»»æ„æ—¶åˆ» crash çš„æƒ…å†µï¼Œæœ‰åŠ©äºç†è§£ raft ç®—æ³•çš„å®¹é”™æ€§ã€‚")]),e._v(" "),r("h1",{attrs:{id:"_6ã€æ€»ç»“"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6ã€æ€»ç»“"}},[e._v("#")]),e._v(" 6ã€æ€»ç»“")]),e._v(" "),r("p",[e._v("raft å°†å…±è¯†é—®é¢˜åˆ†è§£æˆä¸¤ä¸ªç›¸å¯¹ç‹¬ç«‹çš„é—®é¢˜ï¼Œleader electionï¼Œlog replicationã€‚æµç¨‹æ˜¯å…ˆé€‰ä¸¾å‡º leaderï¼Œç„¶å leader è´Ÿè´£å¤åˆ¶ã€æäº¤ logï¼ˆlog ä¸­åŒ…å« commandï¼‰")]),e._v(" "),r("p",[e._v("ä¸ºäº†åœ¨ä»»ä½•å¼‚å¸¸æƒ…å†µä¸‹ç³»ç»Ÿä¸å‡ºé”™ï¼Œå³æ»¡è¶³ safety å±æ€§ï¼Œå¯¹ leader electionï¼Œlog replication ä¸¤ä¸ªå­é—®é¢˜æœ‰è¯¸å¤šçº¦æŸ")]),e._v(" "),r("p",[e._v("leader election çº¦æŸï¼š")]),e._v(" "),r("ul",[r("li",[e._v("åŒä¸€ä»»æœŸå†…æœ€å¤šåªèƒ½æŠ•ä¸€ç¥¨ï¼Œå…ˆæ¥å…ˆå¾—")]),e._v(" "),r("li",[e._v("é€‰ä¸¾äººå¿…é¡»æ¯”è‡ªå·±çŸ¥é“çš„æ›´å¤šï¼ˆæ¯”è¾ƒ termï¼Œlog indexï¼‰")])]),e._v(" "),r("p",[e._v("log replication çº¦æŸï¼š")]),e._v(" "),r("ul",[r("li",[e._v("ä¸€ä¸ª log è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œå°±æ˜¯ committedï¼Œä¿è¯ä¸ä¼šå›æ»š")]),e._v(" "),r("li",[e._v("leader ä¸€å®šåŒ…å«æœ€æ–°çš„ committed logï¼Œå› æ­¤ leader åªä¼šè¿½åŠ æ—¥å¿—ï¼Œä¸ä¼šåˆ é™¤è¦†ç›–æ—¥å¿—")]),e._v(" "),r("li",[e._v("ä¸åŒèŠ‚ç‚¹ï¼ŒæŸä¸ªä½ç½®ä¸Šæ—¥å¿—ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—ä¸€å®šæ˜¯ç›¸åŒçš„")]),e._v(" "),r("li",[e._v("Raft never commits log entries from previous terms by counting replicas.")])]),e._v(" "),r("p",[e._v("æœ¬æ–‡æ˜¯åœ¨çœ‹å®Œ raft è®ºæ–‡åè‡ªå·±çš„æ€»ç»“ï¼Œä¸ä¸€å®šå…¨é¢ã€‚ä¸ªäººè§‰å¾—ï¼Œå¦‚æœåªæ˜¯ç›¸å¯¹ raft åè®®æœ‰ä¸€ä¸ªç®€å•äº†è§£ï¼Œçœ‹è¿™ä¸ª"),r("a",{attrs:{href:"http://thesecretlivesofdata.com/raft/",target:"_blank",rel:"noopener noreferrer"}},[e._v("åŠ¨ç”»æ¼”ç¤º"),r("OutboundLink")],1),e._v("å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœæƒ³æ·±å…¥äº†è§£ï¼Œè¿˜æ˜¯è¦çœ‹è®ºæ–‡ï¼Œè®ºæ–‡ä¸­ Figure 2 å¯¹ raft ç®—æ³•è¿›è¡Œäº†æ¦‚æ‹¬ã€‚æœ€åï¼Œè¿˜æ˜¯æ‰¾ä¸€ä¸ªå®ç°äº† raft ç®—æ³•çš„ç³»ç»Ÿæ¥çœ‹çœ‹æ›´å¥½ã€‚")])])}),[],!1,null,null,null);t.default=l.exports}}]);
